# 简介

IP（Internet Protocol，互联网协议）数据报格式定义了数据包在网络上传输的结构。IPv4和IPv6是两种主要的IP协议版本，它们的数据报格式有所不同。这里主要介绍IPv4数据报格式。

### IPv4数据报格式

IPv4数据报由一个固定长度的报头和可变长度的数据部分组成。IPv4报头最小长度为20字节，包含多个字段，每个字段都有特定的功能。以下是IPv4数据报格式的详细介绍：

报头格式

```plaintext
0                   1                   2                   3  
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|Version|  IHL  |Type of Service|          Total Length         |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|         Identification        |Flags|      Fragment Offset    |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|  Time to Live |    Protocol   |         Header Checksum       |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                       Source Address                          |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                    Destination Address                        |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
|                    Options                    |    Padding    |  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

字段解释：
- 版本（Version，4位）：指示IP协议的版本。对于IPv4，值为4。
- 首部长度（IHL, Internet Header Length，4位）：表示IP报头的长度，以32位字（4字节）为单位。最小值为5（20字节），最大值为15（60字节）。
- 服务类型（Type of Service，8位）：指定数据报的优先级和服务质量。包含优先级字段和具体的服务字段，如延迟、吞吐量、可靠性等。
- 总长度（Total Length，16位）：指定整个IP数据报的长度，包括报头和数据，以字节为单位。最小值为20字节（仅有报头），最大值为65535字节。
- 标识（Identification，16位）：用于唯一标识主机发送的每一个数据报，主要用于数据报分片和重组。
- 标志（Flags，3位）：控制和标识分片。包括3个标志位：1.保留位（未使用，必须为0）；2.不分片（DF, Don't Fragment）；3.更多分片（MF, More Fragments）
- 片偏移（Fragment Offset，13位）：指定数据报的某个片在原始数据报中的相对位置，以8字节为单位。
- 生存时间（TTL, Time to Live，8位）：指定数据报在网络中的最大生存时间，以跳数为单位。每经过一个路由器，该值减1，为0时数据报被丢弃。
- 协议（Protocol，8位）：指定封装在IP数据报中的上层协议类型。例如，TCP为6，UDP为17。
- 头部校验和（Header Checksum，16位）：用于检验IP报头的完整性，通过对报头进行计算生成。
- 源地址（Source Address，32位）：指定发送数据报的源IP地址。
- 目的地址（Destination Address，32位）：指定接收数据报的目的IP地址。
- 选项（Options，可变长度）：可选字段，用于支持网络测试、调试等功能。长度可变。
- 填充（Padding，可变长度）：填充字段，用于确保报头长度是4字节的整数倍。

### 数据部分

紧随报头之后的是数据部分，包含实际传输的负载数据。数据部分的长度取决于报头中总长度字段减去报头长度字段。

### IPv6数据报格式

IPv6数据报相比IPv4有一些不同，IPv6报头更简单，没有选项字段，长度固定为40字节。IPv6报头字段包括版本、流量类、流标签、有效载荷长度、下一个报头、跳数限制、源地址和目的地址。

# 总结

IPv4数据报格式定义了数据包在网络中的传输结构，包括多个关键字段用于标识、路由和检查数据报的完整性。理解这些字段的作用和格式，有助于更好地理解IP协议的工作原理和网络通信。
